{% assign current_product = product.selected_or_first_available_variant %}
{% assign product_image = current_product.featured_image | default: product.featured_image %}

<div class="container">
  <div class="row">
    <div class="col-md-6 col-12">
      <img src="{{ product_image | img_url: 'large'}}" alt="{{ product_image.alt }}" class="img-fluid" id="ProductMainImage" />
      {% for image in product.images %}
        <img src="{{ image.src | img_url: 'medium' }}" alt="{{ image.alt }}">
      {% endfor%}
    </div>
    <div class="col-md-6 col-12">
      <h1>{{ product.title }}</h1>
      <p>{{ current_product.price | money_without_trailing_zeros }}</p>

      {% form 'product', product, class:"product-form", id:"AddToCartForm" %}
        <div class="mb-3">
          <select name="id" id="productSelect" class="form-select">
            {% for variant in product.variants %}
              {% if variant.available %}
                <option value="{{ variant.id }}">{{ variant.title }}</option>
              {% else %}
                <option value="{{ variant.id }}" disabled="disabled">{{ variant.title }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <input name="quantity" id="Quantity" type="number" class="form-control" value="1" min="1" />
        </div>

        <button type="submit" name="add" id="AddToCard" class="btn btn-secondary btn-lg w-100 rounded-0">Add To Cart</button>

        {% if section.settings.dynamic_button_checkbox == true %}
          {{ form | payment_button }}
        {% endif %}
      {% endform%}
    </div>
  </div>
</div>

<div class="container">
  <section id="productRecomendation" class="row justify-content-center my-5">
    <h3 class="text-center">You may also like</h3>
    <div id="productRecomendationBody"></div>
  </section>
</div>

<script>
  const recommendationsContainer = document.getElementById('productRecomendationBody');
  let contents = '';

  fetch('/recommendations/products.json?product_id={{product.id}}')
    .then(res => res.json())
    .then(({ products }) => {
      if (products.length) {
        products.forEach(p => {
          let card = '<div class="col-3 g-2">';
          card += '<div class="card" style="width: 18rem">';

          if (p.images.length) {
            card += `<img class="card-img-top" src=${p.images[0]}>`;
          }
          card += `<div class='card-body'>
            <h4 class=text-center><a href="${p.url}">${p.title}</a></h4>
          </div>`
          card += '</div></div>';
          recommendationsContainer.innerHTML += card;
        });
      }
    });
</script>

{% schema %}
  {
    "name": "Product pages",
    "settings": [
      {
        "type": "checkbox",
        "id": "dynamic_button_checkbox",
        "label": "Enable Dynamic Buttons",
        "default": false
      }
    ]
  }
{% endschema %}
